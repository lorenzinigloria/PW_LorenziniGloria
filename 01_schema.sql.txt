CREATE TABLE ruoli_responsabilita (
    id_responsabile SERIAL PRIMARY KEY,
    nome_cognome VARCHAR(100) NOT NULL,
    ruolo_organizzativo VARCHAR(100) NOT NULL,
    contatto_email VARCHAR(150) UNIQUE NOT NULL
);

CREATE TABLE fornitori_terze_parti (
    id_fornitore SERIAL PRIMARY KEY,
    ragione_sociale VARCHAR(150) NOT NULL,
    stato_conformita VARCHAR(50) DEFAULT 'In Valutazione'
    CHECK (stato_conformita IN ('In Valutazione', 'Conforme', 'Non Conforme'))
);


CREATE TABLE anagrafica_servizi_critici (
    id_servizio SERIAL PRIMARY KEY,
    codice_acn VARCHAR(50) NOT NULL,
    nome_servizio VARCHAR(200) NOT NULL,
    livello_impatto VARCHAR(50) NOT NULL 
    CHECK (livello_impatto IN ('Basso', 'Medio', 'Alto', 'Critico')),
    rto_ore INT NOT NULL,
    id_responsabile INT NOT NULL,
    CONSTRAINT fk_servizio_resp FOREIGN KEY (id_responsabile) 
        REFERENCES ruoli_responsabilita(id_responsabile) 
        ON UPDATE CASCADE ON DELETE RESTRICT
);


CREATE TABLE inventario_asset_ict (
    id_asset SERIAL PRIMARY KEY,
    tipo_asset VARCHAR(50) NOT NULL,
    identificativo_logico VARCHAR(100) UNIQUE NOT NULL,
    id_fornitore INT,
    CONSTRAINT fk_asset_fornitore FOREIGN KEY (id_fornitore) 
        REFERENCES fornitori_terze_parti(id_fornitore) ON UPDATE CASCADE ON DELETE SET NULL
);


CREATE TABLE dipendenze_asset_servizio (
    id_dipendenza SERIAL PRIMARY KEY,
    id_servizio INT NOT NULL,
    id_asset INT NOT NULL,
    tipo_relazione VARCHAR(100),
    CONSTRAINT fk_dip_servizio FOREIGN KEY (id_servizio) 
        REFERENCES anagrafica_servizi_critici(id_servizio) ON DELETE CASCADE,
    CONSTRAINT fk_dip_asset FOREIGN KEY (id_asset) 
        REFERENCES inventario_asset_ict(id_asset) ON DELETE CASCADE
);

CREATE INDEX idx_codice_acn ON anagrafica_servizi_critici(codice_acn);
CREATE INDEX idx_dip_servizio ON dipendenze_asset_servizio(id_servizio);